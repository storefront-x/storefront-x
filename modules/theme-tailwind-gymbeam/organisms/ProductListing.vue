<template>
  <div class="relative lg:static">
    <div class="pt-8 md:pt-4 flex">
      <div class="basis-1/4">
        <nav class="sidebar-navigation bg-grey-890 p-2">
          <ul class="">
            <li class="level0 nav-1 category-item first level-top !mt-0">
              <a href="https://gymbeam.sk/novorocny-vypredaj" class="level-top"><span>Novoročný výpredaj</span></a>
              <em></em>
            </li>
            <li class="level0 nav-2 category-item level-top parent">
              <a href="https://gymbeam.sk/sportova-vyziva" class="level-top"><span>Športová výživa</span></a>
              <em></em>
              <ul class="level0 submenu pl-[10px] inline-block">
                <li class="level1 nav-2-1 category-item first parent">
                  <a href="https://gymbeam.sk/3-proteiny"><span>Proteíny</span></a> <em></em>
                  <ul class="level1 submenu hidden">
                    <li class="level2 nav-2-1-1 category-item first parent">
                      <a href="https://gymbeam.sk/srvatkovy-whey-protein"><span>Srvátkový whey proteín</span></a>
                      <em></em>
                      <ul class="level2 submenu hidden">
                        <li class="level3 nav-2-1-1-1 category-item first">
                          <a href="https://gymbeam.sk/proteinove-koncentraty"><span>Proteínové koncentráty</span></a>
                          <em></em>
                        </li>
                        <li class="level3 nav-2-1-1-2 category-item">
                          <a href="https://gymbeam.sk/proteinove-izolaty"><span>Proteínové izoláty</span></a>
                          <em></em>
                        </li>
                        <li class="level3 nav-2-1-1-3 category-item">
                          <a href="https://gymbeam.sk/hydrolyzovane-proteiny"><span>Hydrolyzované proteíny</span></a>
                          <em></em>
                        </li>
                        <li class="level3 nav-2-1-1-4 category-item last">
                          <a href="https://gymbeam.sk/viaczlozkove-srvatkove-proteiny"
                            ><span>Viaczložkové srvátkové proteíny</span></a
                          >
                          <em></em>
                        </li>
                      </ul>
                    </li>
                    <li class="level2 nav-2-1-2 category-item">
                      <a href="https://gymbeam.sk/viaczlozkovy-protein"><span>Viaczložkový proteín</span></a>
                      <em></em>
                    </li>
                    <li class="level2 nav-2-1-3 category-item">
                      <a href="https://gymbeam.sk/28-nocne-proteiny"><span>Nočné proteíny</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-1-4 category-item">
                      <a href="https://gymbeam.sk/proteiny-na-rastlinnej-baze"
                        ><span>Proteíny na rastlinnej báze </span></a
                      >
                      <em></em>
                    </li>
                    <li class="level2 nav-2-1-5 category-item">
                      <a href="https://gymbeam.sk/kolagen"><span>Kolagén</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-1-6 category-item">
                      <a href="https://gymbeam.sk/34-ladies-protein"><span>Proteíny pre ženy</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-1-7 category-item">
                      <a href="https://gymbeam.sk/hovadzi-beef-protein"><span>Hovädzie proteíny</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-1-8 category-item">
                      <a href="https://gymbeam.sk/sojovy-protein"><span>Sójový proteín</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-1-9 category-item">
                      <a href="https://gymbeam.sk/narast-svalovej-hmoty"><span>Proteíny na rast svalov</span></a>
                      <em></em>
                    </li>
                    <li class="level2 nav-2-1-10 category-item last">
                      <a href="https://gymbeam.sk/proteiny-ostatne"><span>Proteíny ostatné </span></a> <em></em>
                    </li>
                  </ul>
                </li>
                <li class="level1 nav-2-2 category-item parent">
                  <a href="https://gymbeam.sk/33-spalovace-tukov"><span>Spaľovače tuku</span></a> <em></em>
                  <ul class="level1 submenu">
                    <li class="level2 nav-2-2-1 category-item first">
                      <a href="https://gymbeam.sk/komplexne-spalovace"><span>Komplexné spaľovače</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-2-2 category-item">
                      <a href="https://gymbeam.sk/l-karnitin"><span>L-Karnitíny</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-2-3 category-item">
                      <a href="https://gymbeam.sk/termo-spalovace"><span>Termo spaľovače</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-2-4 category-item last">
                      <a href="https://gymbeam.sk/ostatne-spalovace-tukov"><span>Ostatné spaľovače tukov</span></a>
                      <em></em>
                    </li>
                  </ul>
                </li>
                <li class="level1 nav-2-3 category-item parent">
                  <a href="https://gymbeam.sk/5-gainery"><span>Gainery a sacharidy</span></a> <em></em>
                  <ul class="level1 submenu hidden">
                    <li class="level2 nav-2-3-1 category-item first">
                      <a href="https://gymbeam.sk/gainery"><span>Gainery</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-3-2 category-item">
                      <a href="https://gymbeam.sk/sacharidy"><span>Pomalé sacharidy</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-3-3 category-item">
                      <a href="https://gymbeam.sk/rychle-sacharidy"><span>Rýchle sacharidy</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-3-4 category-item">
                      <a href="https://gymbeam.sk/energeticke-gely"><span>Energetické gély</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-3-5 category-item last">
                      <a href="https://gymbeam.sk/69-all-in-one"><span>All-in-one</span></a> <em></em>
                    </li>
                  </ul>
                </li>
                <li class="level1 nav-2-4 category-item parent">
                  <a href="https://gymbeam.sk/23-klbova-vyziva"><span>Kĺbová výživa</span></a> <em></em>
                  <ul class="level1 submenu hidden">
                    <li class="level2 nav-2-4-1 category-item first">
                      <a href="https://gymbeam.sk/komplexne-klbove-vyzivy"><span>Komplexné kĺbové výživy</span></a>
                      <em></em>
                    </li>
                    <li class="level2 nav-2-4-2 category-item">
                      <a href="https://gymbeam.sk/kolagenove-klbove-vyzivy"><span>Kolagénové kĺbové výživy</span></a>
                      <em></em>
                    </li>
                    <li class="level2 nav-2-4-3 category-item">
                      <a href="https://gymbeam.sk/glukozamin"><span>Glukozamín</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-4-4 category-item last">
                      <a href="https://gymbeam.sk/ostatne-klbove-vyzivy"><span>Ostatné kĺbové výživy</span></a>
                      <em></em>
                    </li>
                  </ul>
                </li>
                <li class="level1 nav-2-5 category-item parent">
                  <a href="https://gymbeam.sk/aminokyseliny"><span>Aminokyseliny</span></a> <em></em>
                  <ul class="level1 submenu hidden">
                    <li class="level2 nav-2-5-1 category-item first">
                      <a href="https://gymbeam.sk/komplexne-aminokyseliny"><span>Komplexné aminokyseliny</span></a>
                      <em></em>
                    </li>
                    <li class="level2 nav-2-5-2 category-item">
                      <a href="https://gymbeam.sk/42-bcaa"><span>BCAA</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-5-3 category-item">
                      <a href="https://gymbeam.sk/eaa"><span>EAA</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-5-4 category-item">
                      <a href="https://gymbeam.sk/107-arginin"><span>Arginín</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-5-5 category-item">
                      <a href="https://gymbeam.sk/43-glutamin"><span>Glutamín</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-5-6 category-item last">
                      <a href="https://gymbeam.sk/ostatne-aminokyseliny"><span>Ostatné aminokyseliny</span></a>
                      <em></em>
                    </li>
                  </ul>
                </li>
                <li class="level1 nav-2-6 category-item parent">
                  <a href="https://gymbeam.sk/vitaminy"><span>Vitamíny</span></a> <em></em>
                  <ul class="level1 submenu hidden">
                    <li class="level2 nav-2-6-1 category-item first">
                      <a href="https://gymbeam.sk/komplexne-vitaminy"><span>Multivitamín</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-6-2 category-item">
                      <a href="https://gymbeam.sk/vitamin-a"><span>Vitamín A</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-6-3 category-item">
                      <a href="https://gymbeam.sk/vitamin-b"><span>Vitamíny B</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-6-4 category-item">
                      <a href="https://gymbeam.sk/vitamin-c"><span>Vitamín C</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-6-5 category-item">
                      <a href="https://gymbeam.sk/vitamin-d"><span>Vitamín D</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-6-6 category-item">
                      <a href="https://gymbeam.sk/vitamin-e"><span>Vitamín E</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-6-7 category-item last">
                      <a href="https://gymbeam.sk/ostatne-vitaminy"><span>Ostatné vitamíny</span></a> <em></em>
                    </li>
                  </ul>
                </li>
                <li class="level1 nav-2-7 category-item parent">
                  <a href="https://gymbeam.sk/mineraly-1"><span>Minerály</span></a> <em></em>
                  <ul class="level1 submenu hidden">
                    <li class="level2 nav-2-7-1 category-item first">
                      <a href="https://gymbeam.sk/komplexne-mineraly"><span>Multiminerály</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-7-2 category-item">
                      <a href="https://gymbeam.sk/magnezium"><span>Magnézium</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-7-3 category-item">
                      <a href="https://gymbeam.sk/vapnik"><span>Vápnik</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-7-4 category-item">
                      <a href="https://gymbeam.sk/zelezo"><span>Železo</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-7-5 category-item">
                      <a href="https://gymbeam.sk/zinok"><span>Zinok</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-7-6 category-item">
                      <a href="https://gymbeam.sk/zma-zmb"><span>ZMA a ZMB</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-7-7 category-item last">
                      <a href="https://gymbeam.sk/ostatne-mineraly"><span>Ostatné minerály</span></a> <em></em>
                    </li>
                  </ul>
                </li>
                <li class="level1 nav-2-8 category-item parent">
                  <a href="https://gymbeam.sk/zdrave-tuky"><span>Zdravé tuky</span></a> <em></em>
                  <ul class="level1 submenu hidden">
                    <li class="level2 nav-2-8-1 category-item first">
                      <a href="https://gymbeam.sk/omega-3-mastne-kyseliny"><span>Omega-3</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-8-2 category-item">
                      <a href="https://gymbeam.sk/omega-3-6-9"><span>Omega 3-6-9</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-8-3 category-item">
                      <a href="https://gymbeam.sk/krilovy-olej"><span>Krilový olej </span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-8-4 category-item">
                      <a href="https://gymbeam.sk/tekuty-rybi-olej"><span>Tekutý rybí olej </span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-8-5 category-item">
                      <a href="https://gymbeam.sk/cla-a-hca"><span>CLA a HCA</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-8-6 category-item">
                      <a href="https://gymbeam.sk/lecitin"><span>Lecitín</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-8-7 category-item">
                      <a href="https://gymbeam.sk/mct-olej"><span>MCT olej</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-8-8 category-item last">
                      <a href="https://gymbeam.sk/ostatne-zdrave-tuky"><span>Ostatné zdravé tuky</span></a> <em></em>
                    </li>
                  </ul>
                </li>
                <li class="level1 nav-2-9 category-item parent">
                  <a href="https://gymbeam.sk/14-kreatin"><span>Kreatín</span></a> <em></em>
                  <ul class="level1 submenu hidden">
                    <li class="level2 nav-2-9-1 category-item first">
                      <a href="https://gymbeam.sk/82-kreatin-monohydrat"><span>Kreatín Monohydrát</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-9-2 category-item">
                      <a href="https://gymbeam.sk/84-kreatin-ethyl-ester"><span>Kreatín iné formy</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-9-3 category-item last">
                      <a href="https://gymbeam.sk/viaczlozkovy-kreatin"><span>Viaczložkový kreatín</span></a>
                      <em></em>
                    </li>
                  </ul>
                </li>
                <li class="level1 nav-2-10 category-item parent">
                  <a href="https://gymbeam.sk/ostatne-doplnky-vyzivy"><span>Ostatné doplnky výživy</span></a>
                  <em></em>
                  <ul class="level1 submenu hidden">
                    <li class="level2 nav-2-10-1 category-item first">
                      <a href="https://gymbeam.sk/probiotika"><span>Probiotiká a tráviace enzýmy</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-10-2 category-item">
                      <a href="https://gymbeam.sk/rastlinne-doplnky"><span>Rastlinné doplnky</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-10-3 category-item">
                      <a href="https://gymbeam.sk/pre-lepsi-spanok"><span>Pre lepší spánok</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-10-4 category-item">
                      <a href="https://gymbeam.sk/proti-krcom"><span>Proti kŕčom </span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-10-5 category-item">
                      <a href="https://gymbeam.sk/vlasy-nechty-a-pokozka"><span>Vlasy, nechty a pokožka</span></a>
                      <em></em>
                    </li>
                    <li class="level2 nav-2-10-6 category-item">
                      <a href="https://gymbeam.sk/nootropika-a-mozog"><span>Nootropiká a mozog </span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-10-7 category-item">
                      <a href="https://gymbeam.sk/gaming"><span>Gaming</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-10-8 category-item">
                      <a href="https://gymbeam.sk/podpora-pecene"><span>Podpora pečene </span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-10-9 category-item">
                      <a href="https://gymbeam.sk/proti-starnutiu"><span>Proti starnutiu</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-10-10 category-item">
                      <a href="https://gymbeam.sk/huby"><span>Huby </span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-10-11 category-item last">
                      <a href="https://gymbeam.sk/ostatne-specialne-doplnky-vyzivy"
                        ><span>Ostatné špeciálne doplnky výživy </span></a
                      >
                      <em></em>
                    </li>
                  </ul>
                </li>
                <li class="level1 nav-2-11 category-item parent">
                  <a href="https://gymbeam.sk/doplnky-vyzivy-podla-ciela"><span>Doplnky výživy podľa cieľa</span></a>
                  <em></em>
                  <ul class="level1 submenu hidden">
                    <li class="level2 nav-2-11-1 category-item first">
                      <a href="https://gymbeam.sk/budovanie-svalovej-hmoty"><span>Budovanie svalovej hmoty</span></a>
                      <em></em>
                    </li>
                    <li class="level2 nav-2-11-2 category-item">
                      <a href="https://gymbeam.sk/na-chudnutie"><span>Na chudnutie</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-11-3 category-item">
                      <a href="https://gymbeam.sk/podpora-regeneracie"><span>Podpora regenerácie</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-11-4 category-item">
                      <a href="https://gymbeam.sk/zlepsenie-vykonu"><span>Zlepšenie výkonu</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-11-5 category-item last">
                      <a href="https://gymbeam.sk/na-podporu-imunity"><span>Na podporu imunity</span></a> <em></em>
                    </li>
                  </ul>
                </li>
                <li class="level1 nav-2-12 category-item last parent mb-0">
                  <a href="https://gymbeam.sk/86-anabolizerystimulanty"><span>Anabolizéry a stimulanty</span></a>
                  <em></em>
                  <ul class="level1 submenu hidden">
                    <li class="level2 nav-2-12-1 category-item first">
                      <a href="https://gymbeam.sk/21-predtreningove-stimulanty"
                        ><span>Predtréningové stimulanty</span></a
                      >
                      <em></em>
                    </li>
                    <li class="level2 nav-2-12-2 category-item">
                      <a href="https://gymbeam.sk/no-doplnky"><span>NO doplnky</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-12-3 category-item">
                      <a href="https://gymbeam.sk/66-hmb"><span>HMB</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-12-4 category-item">
                      <a href="https://gymbeam.sk/37-nahrada-steroidov"><span>Náhrada steroidov</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-12-5 category-item">
                      <a href="https://gymbeam.sk/kofein"><span>Kofeín</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-12-6 category-item">
                      <a href="https://gymbeam.sk/beta-alanin"><span>Beta-Alanín</span></a> <em></em>
                    </li>
                    <li class="level2 nav-2-12-7 category-item last">
                      <a href="https://gymbeam.sk/daa"><span>DAA</span></a> <em></em>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
            <li class="level0 nav-3 category-item level-top parent">
              <a href="https://gymbeam.sk/zdrave-potraviny" class="level-top"><span>Zdravé potraviny</span></a>
              <em></em>
            </li>
            <li class="level0 nav-4 category-item level-top parent">
              <a href="https://gymbeam.sk/fitness-oblecenie" class="level-top"><span>Fitness oblečenie</span></a>
              <em></em>
            </li>
            <li class="level0 nav-5 category-item last level-top parent">
              <a href="https://gymbeam.sk/prislusenstvo" class="level-top"><span>Príslušenstvo</span></a> <em></em>
            </li>
          </ul>
        </nav>
      </div>

      <div class="basis-3/4 pl-5">
        <CategoryInfo :category="category" />

        <div class="">
          <ProductFilters :aggregations="aggregations" />
        </div>

        <div aria-labelledby="product-heading" class="mt-6 lg:mt-0 lg:col-span-2 xl:col-span-5">
          <h2 id="product-heading" class="sr-only">Products</h2>

          <div
            class="absolute right-0 top-8 lg:top-[unset] lg:right-[unset] lg:static lg:flex lg:justify-between lg:items-end"
          >
            <h3 class="hidden lg:block mb-4 text-neutral-600 text-lg font-medium">
              {{ t('products_found', [totalCount]) }}
            </h3>

            <ProductSort class="mb-4" :title="t(sortedBy)" />
          </div>

          <div class="grid grid-cols-1 gap-2 sm:gap-0 sm:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-3">
            <ProductProvider v-for="(product, i) in products" :key="product.id" :product="product">
              <ProductTile :preload-image="i === 0" :index="i" />
            </ProductProvider>
          </div>

          <div class="flex justify-between items-center mt-8">
            <Pagination :total="totalCount" class="my-8" />
          </div>
          <slot name="bellow-products" />
          <LoadNext :total="totalCount" class="my-8" />
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import useI18n from '#ioc/composables/useI18n'
import useRoute from '#ioc/composables/useRoute'
import ToProduct from '#ioc/mappers/ToProduct'
import ProductSort from '#ioc/molecules/ProductSort'
import ProductTile from '#ioc/molecules/ProductTile'
import ProductProvider from '#ioc/providers/ProductProvider'
import { computed, PropType } from 'vue'
import hydrateWhenVisible from '#ioc/utils/hydration/hydrateWhenVisible'
import hydrateWhenIdle from '#ioc/utils/hydration/hydrateWhenIdle'
import LoadNext from '#ioc/molecules/LoadNext'
const ProductFilters = hydrateWhenIdle(() => import('#ioc/molecules/ProductFilters'))
const Pagination = hydrateWhenVisible(() => import('#ioc/molecules/Pagination'))
import CategoryInfo from '#ioc/molecules/CategoryInfo'
import ToCategory from '#ioc/mappers/ToCategory'

const { t } = useI18n()
const route = useRoute()

defineProps({
  category: {
    type: Object as PropType<ReturnType<typeof ToCategory>>,
    required: true,
  },
  products: {
    type: Array as PropType<ReturnType<typeof ToProduct>[]>,
    required: true,
  },
  aggregations: {
    type: Array,
    default: () => [],
  },
  totalCount: {
    type: Number,
    required: true,
  },
})

const sortedBy = computed(() => String(route.query.sort ?? 'Best match'))
</script>

<i18n lang="yaml">
cs-CZ:
  Best match: nejlepší shoda
  'price,ASC': 'nejlevnějších'
  'price,DESC': 'nejdražších'
  'products_found': 'Nalezeno produktů: {0}'
en-US:
  'price,ASC': 'lowest price'
  'price,DESC': 'highest price'
  'products_found': 'Products found: {0}'
</i18n>

<style scoped>
.sidebar-navigation {
  @apply bg-grey-890 p-3;
}
.sidebar-navigation ul {
  @apply list-none p-0 m-0;
}

.sidebar-navigation ul.submenu {
  @apply pl-2;
}

.sidebar-navigation a {
  @apply text-sm transition-colors ease-in-out hover:text-secondary-500;
}

.sidebar-navigation li {
  @apply flex justify-between flex-wrap my-[15px];
}

.sidebar-navigation li:last-child {
  @apply mb-0;
}

.sidebar-navigation .parent > em {
  content: url('data:image/svg+xml; utf8, <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="rgba(0,0,0)" viewBox="0 0 28 28"><path d="M8.641 17.992l-1.641-1.641 7-7 7 7-1.641 1.641-5.359-5.359z"></path></svg>');
  @apply cursor-pointer w-[20px] rotate-180;
}

.sidebar-navigation a.level-top {
  @apply font-bold;
}
</style>
